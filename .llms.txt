# n8n-scraper-docker: LLM Context

PROJECT_TYPE: docker_microservices
LANGUAGE: python, shell, yaml, javascript
FRAMEWORK: fastapi, n8n, docker-compose
VERSION: 3.0.0
STATUS: production

ENTRY_POINTS:
- docker-compose.yml (main orchestration)
- ml/app.py (ML service - FastAPI)
- scrapers/*.py (scraper implementations)
- workflows/*.json (n8n workflow definitions)

TESTING:
- Unit: pytest tests/unit/
- Integration: pytest tests/integration/
- E2E: bash tests/master/test_full_e2e.sh
- CI: GitHub Actions (2.5min runtime)

DOCUMENTATION:
- .ai/context.md (quick overview)
- .ai/instructions.md (coding patterns)
- ARCHITECTURE.md (design decisions)
- docs/CONTRIBUTING_AI.md (AI agent guide)
- SECURITY.md (security policy)

SECURITY:
- CVE-2025-62725: Docker Compose < v2.40.2 vulnerable
- Exposed ports: 5432 (postgres), 6379 (redis), 9090 (prometheus), 3000 (grafana), 5678 (n8n)
- No TLS by default (add nginx/caddy reverse proxy)
- Secrets in .env (never commit)

DEPENDENCIES:
- Python: fastapi==0.122.0, numpy==2.3.5, scikit-learn==1.7.2, redis[hiredis]==7.1.0
- Docker: postgres:16-alpine, redis:7-alpine, n8n:1.121.3, ollama:latest
- Node: n8n workflow runtime

ARCHITECTURE:
- 8 microservices: n8n, postgres, redis, tor, ml-service, ollama, prometheus, grafana
- ML routing: Firecrawl (premium) → Jina AI (free) → nodriver (local)
- Tor proxy for IP rotation
- Redis for caching and rate limiting
- Prometheus + Grafana for monitoring

METRICS:
- Success rate: 87%
- Latency: 5.3s average
- Cost: $2.88/1000 URLs
- Uptime: 99.8%

COMMANDS:
start: docker-compose up -d
stop: docker-compose down
test: bash tests/master/test_full_e2e.sh
logs: docker-compose logs -f [service]
backup: docker-compose exec postgres pg_dump -U n8n_user n8n_db | gzip > backup.sql.gz
restore: gunzip -c backup.sql.gz | docker-compose exec -T postgres psql -U n8n_user n8n_db
health: docker-compose ps
metrics: open http://localhost:9090
dashboard: open http://localhost:3000

ENVIRONMENT:
- POSTGRES_PASSWORD (required, 20+ chars)
- REDIS_PASSWORD (required, 20+ chars)
- N8N_PASSWORD (required, 20+ chars)
- FIRECRAWL_API_KEY (optional, for premium scraping)
- JINA_API_KEY (optional, free tier available)

KEY_FEATURES:
- Hybrid fallback strategy (3 scraper tiers)
- ML-based smart routing
- Anti-bot detection (Cloudflare bypass 90-95%)
- IP rotation via Tor
- Full observability (Prometheus/Grafana)
- Zero memory leaks (72h stress tested)

COMMON_TASKS:
- Add scraper: Create scrapers/[name].py, register in ml/app.py
- Update ML logic: Edit ml/app.py route_scraping_request()
- Add workflow: Import JSON in n8n UI (http://localhost:5678)
- Debug service: docker-compose logs [service]
- Check health: curl http://localhost:[port]/health

ANTI_PATTERNS:
- Using :latest tags in production
- Hardcoding secrets
- Exposing DB ports without firewall
- Skipping healthchecks
- Using localStorage in n8n (CSP violation)

PERFORMANCE_TARGETS:
- Response time: <5.3s
- Success rate: ≥87%
- Memory: Stable (no leaks)
- Cost: ≤$2.88/1000 URLs

RESOURCES:
- GitHub: https://github.com/KomarovAI/n8n-scraper-docker
- n8n Docs: https://docs.n8n.io/
- Firecrawl: https://docs.firecrawl.dev/
- Jina AI: https://jina.ai/reader/

MAINTAINER: @KomarovAI
LICENSE: MIT
LAST_UPDATED: 2025-11-29
