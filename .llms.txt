# n8n-scraper-docker: LLM Context

PROJECT: docker_microservices | python,shell,yaml,js | fastapi,n8n,docker-compose
STATUS: production v3.0.0

## Quick Start
```bash
docker-compose up -d                    # Start all services
bash tests/master/test_full_e2e.sh      # Run tests
docker-compose logs -f [service]        # View logs
```

## Architecture (8 services)
```
n8n:5678 → postgres:5432 + redis:6379 + tor:9050
         → ml-service:8000 ←→ ollama:11434
         → prometheus:9090 → grafana:3000
```

**ML Routing**: Firecrawl (premium) → Jina AI (free) → nodriver (local)
**Metrics**: 87% success | 5.3s latency | $2.88/1K URLs | 99.8% uptime

## Critical Files
- `docker-compose.yml` - Service orchestration
- `ml/app.py` - ML routing logic
- `scrapers/*.py` - Scraper implementations  
- `workflows/*.json` - n8n workflows
- `.env.example` - Config template

## Environment (Required)
```bash
POSTGRES_PASSWORD=<20+ chars>  # openssl rand -base64 24
REDIS_PASSWORD=<20+ chars>
N8N_PASSWORD=<20+ chars>
FIRECRAWL_API_KEY=fc-xxx     # Optional
JINA_API_KEY=jina-xxx         # Optional
```

## Common Tasks
```bash
# Management
docker-compose restart [service]
docker-compose down -v              # Full cleanup
git pull && docker-compose up -d    # Update

# Backup/Restore
docker-compose exec postgres pg_dump -U n8n_user n8n_db | gzip > backup.sql.gz
gunzip -c backup.sql.gz | docker-compose exec -T postgres psql -U n8n_user n8n_db

# Debugging
curl http://localhost:5678/healthz  # n8n health
curl http://localhost:8000/health   # ML service
docker-compose exec redis redis-cli ping
docker-compose exec ollama ollama list
```

## Development
```bash
# Add scraper: Create scrapers/[name].py, register in ml/app.py
# Update ML: Edit ml/app.py route_scraping_request()
# Add workflow: Import JSON in n8n UI (localhost:5678)
```

## Security ⚠️
**CVE-2025-62725**: Docker Compose < v2.40.2 vulnerable (path traversal)
**Production**: Close ports 5432,6379 | Add nginx/caddy TLS | Never commit .env

## Anti-patterns
❌ Using :latest in production
❌ Hardcoding secrets
❌ Exposing DB ports without firewall
❌ Using localStorage in n8n (CSP violation)

## Documentation
- `.ai/context.md` - Quick overview
- `.ai/instructions.md` - Coding patterns  
- `ARCHITECTURE.md` - Design decisions
- `SECURITY.md` - Security policy
- `docs/TROUBLESHOOTING.md` - Common issues

## Resources
- GitHub: https://github.com/KomarovAI/n8n-scraper-docker
- n8n: https://docs.n8n.io/
- Firecrawl: https://docs.firecrawl.dev/
- Jina: https://jina.ai/reader/

MAINTAINER: @KomarovAI | LICENSE: MIT | UPDATED: 2025-11-29
