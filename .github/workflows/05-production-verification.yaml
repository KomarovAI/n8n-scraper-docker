name: 4 Production Verification - FINAL BOSS CHECKS

on:
  # ğŸ¯ Ğ—ĞĞŸĞ£Ğ¡Ğš ĞŸĞĞ¡Ğ›Ğ• Ğ£Ğ¡ĞŸĞ•Ğ¨ĞĞĞ“Ğ Ğ”Ğ•ĞŸĞ›ĞĞ¯
  workflow_run:
    workflows: ["3 Production Deployment"]
    types: [completed]
    branches: [main]
  
  # Manual trigger
  workflow_dispatch:

concurrency:
  group: production-verification
  cancel-in-progress: false

env:
  N8N_URL: http://192.168.0.105:5678
  GRAFANA_URL: http://192.168.0.105:3001
  PROMETHEUS_URL: http://192.168.0.105:9090
  DEPLOY_DIR: /home/artikk/n8n-production

jobs:
  # ğŸ” Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²
  basic-health-checks:
    name: ğŸ¥ Basic Health Checks
    runs-on: self-hosted
    timeout-minutes: 5
    outputs:
      n8n_status: ${{ steps.check.outputs.n8n_status }}
      db_status: ${{ steps.check.outputs.db_status }}
      redis_status: ${{ steps.check.outputs.redis_status }}
      tor_status: ${{ steps.check.outputs.tor_status }}
    steps:
      - name: ğŸ¥ Check all services
        id: check
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ” BASIC HEALTH CHECKS"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          
          TOTAL=0
          PASSED=0
          FAILED=0
          
          # 1. n8n Health
          echo "1ï¸âƒ£ Checking n8n..."
          if curl -sf ${{ env.N8N_URL }}/healthz > /dev/null 2>&1; then
            echo "   âœ… n8n is healthy"
            echo "n8n_status=healthy" >> $GITHUB_OUTPUT
            PASSED=$((PASSED + 1))
          else
            echo "   âŒ n8n is DOWN!"
            echo "n8n_status=unhealthy" >> $GITHUB_OUTPUT
            FAILED=$((FAILED + 1))
          fi
          TOTAL=$((TOTAL + 1))
          
          # 2. PostgreSQL
          echo "2ï¸âƒ£ Checking PostgreSQL..."
          if docker exec postgres pg_isready -U n8n > /dev/null 2>&1; then
            echo "   âœ… PostgreSQL is ready"
            echo "db_status=healthy" >> $GITHUB_OUTPUT
            PASSED=$((PASSED + 1))
          else
            echo "   âŒ PostgreSQL is DOWN!"
            echo "db_status=unhealthy" >> $GITHUB_OUTPUT
            FAILED=$((FAILED + 1))
          fi
          TOTAL=$((TOTAL + 1))
          
          # 3. Redis
          echo "3ï¸âƒ£ Checking Redis..."
          if docker exec redis redis-cli ping 2>/dev/null | grep -q PONG; then
            echo "   âœ… Redis is responding"
            echo "redis_status=healthy" >> $GITHUB_OUTPUT
            PASSED=$((PASSED + 1))
          else
            echo "   âŒ Redis is DOWN!"
            echo "redis_status=unhealthy" >> $GITHUB_OUTPUT
            FAILED=$((FAILED + 1))
          fi
          TOTAL=$((TOTAL + 1))
          
          # 4. Tor
          echo "4ï¸âƒ£ Checking Tor proxy..."
          if docker ps | grep -q tor-proxy; then
            echo "   âœ… Tor container is running"
            echo "tor_status=healthy" >> $GITHUB_OUTPUT
            PASSED=$((PASSED + 1))
          else
            echo "   âš ï¸  Tor is not running"
            echo "tor_status=unhealthy" >> $GITHUB_OUTPUT
            FAILED=$((FAILED + 1))
          fi
          TOTAL=$((TOTAL + 1))
          
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ“Š Summary: $PASSED/$TOTAL passed"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          
          if [ $FAILED -gt 0 ]; then
            echo "âŒ Some services are DOWN!"
            exit 1
          fi
          
          echo "âœ… All basic services are healthy!"

  # ğŸ§ª ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ n8n workflows
  workflow-functionality-tests:
    name: ğŸ§ª Workflow Functionality Tests
    runs-on: self-hosted
    needs: basic-health-checks
    timeout-minutes: 10
    outputs:
      workflows_active: ${{ steps.test.outputs.workflows_active }}
      webhooks_working: ${{ steps.test.outputs.webhooks_working }}
    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v6
      
      - name: ğŸ§ª Test n8n workflows
        id: test
        env:
          N8N_API_KEY: ${{ secrets.N8N_API_KEY }}
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ§ª WORKFLOW FUNCTIONALITY TESTS"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          
          # 1. Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº workflows
          echo "1ï¸âƒ£ Checking workflows list..."
          WORKFLOWS=$(curl -sf \
            -H "X-N8N-API-KEY: $N8N_API_KEY" \
            "${{ env.N8N_URL }}/api/v1/workflows")
          
          if [ -n "$WORKFLOWS" ]; then
            WORKFLOW_COUNT=$(echo "$WORKFLOWS" | jq '.data | length')
            echo "   âœ… Found $WORKFLOW_COUNT workflows"
            
            # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ…
            ACTIVE_COUNT=$(echo "$WORKFLOWS" | jq '[.data[] | select(.active == true)] | length')
            echo "   âœ… $ACTIVE_COUNT workflows are active"
            echo "workflows_active=$ACTIVE_COUNT" >> $GITHUB_OUTPUT
          else
            echo "   âŒ Failed to fetch workflows!"
            echo "workflows_active=0" >> $GITHUB_OUTPUT
            exit 1
          fi
          
          # 2. Test webhook endpoint
          echo "2ï¸âƒ£ Testing webhook endpoint..."
          WEBHOOK_TEST=$(curl -sf -X POST \
            -H "Content-Type: application/json" \
            -d '{"url":"https://example.com","test":true}' \
            "${{ env.N8N_URL }}/webhook-test/scrape" 2>/dev/null || echo "failed")
          
          if [ "$WEBHOOK_TEST" != "failed" ]; then
            echo "   âœ… Webhook endpoint is responding"
            echo "webhooks_working=true" >> $GITHUB_OUTPUT
          else
            echo "   âš ï¸  Webhook endpoint not responding (might be expected)"
            echo "webhooks_working=false" >> $GITHUB_OUTPUT
          fi
          
          # 3. Test executions API
          echo "3ï¸âƒ£ Checking recent executions..."
          EXECUTIONS=$(curl -sf \
            -H "X-N8N-API-KEY: $N8N_API_KEY" \
            "${{ env.N8N_URL }}/api/v1/executions?limit=5")
          
          if [ -n "$EXECUTIONS" ]; then
            EXEC_COUNT=$(echo "$EXECUTIONS" | jq '.data | length')
            echo "   âœ… Found $EXEC_COUNT recent executions"
          else
            echo "   âš ï¸  No recent executions (might be fresh deployment)"
          fi
          
          echo ""
          echo "âœ… Workflow functionality tests passed!"

  # ğŸ“Š ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° monitoring stack
  monitoring-stack-verification:
    name: ğŸ“Š Monitoring Stack Verification
    runs-on: self-hosted
    needs: basic-health-checks
    timeout-minutes: 5
    steps:
      - name: ğŸ“Š Check monitoring services
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ“Š MONITORING STACK VERIFICATION"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          
          MONITORING_OK=true
          
          # 1. Prometheus
          echo "1ï¸âƒ£ Checking Prometheus..."
          if curl -sf ${{ env.PROMETHEUS_URL }}/-/healthy > /dev/null 2>&1; then
            echo "   âœ… Prometheus is healthy"
            
            # Check targets
            TARGETS=$(curl -sf ${{ env.PROMETHEUS_URL }}/api/v1/targets | jq '.data.activeTargets | length')
            echo "   ğŸ“¡ Active targets: $TARGETS"
          else
            echo "   âš ï¸  Prometheus is not responding"
            MONITORING_OK=false
          fi
          
          # 2. Grafana
          echo "2ï¸âƒ£ Checking Grafana..."
          if curl -sf ${{ env.GRAFANA_URL }}/api/health > /dev/null 2>&1; then
            echo "   âœ… Grafana is healthy"
            
            # Check datasources
            DATASOURCES=$(curl -sf \
              -u "${{ secrets.GRAFANA_USER_CI }}:${{ secrets.GRAFANA_PASSWORD_CI }}" \
              ${{ env.GRAFANA_URL }}/api/datasources | jq 'length')
            echo "   ğŸ“Š Configured datasources: $DATASOURCES"
          else
            echo "   âš ï¸  Grafana is not responding"
            MONITORING_OK=false
          fi
          
          # 3. Node Exporter (if exists)
          echo "3ï¸âƒ£ Checking Node Exporter..."
          if curl -sf http://localhost:9100/metrics > /dev/null 2>&1; then
            echo "   âœ… Node Exporter is running"
          else
            echo "   âš ï¸  Node Exporter not found (optional)"
          fi
          
          echo ""
          if [ "$MONITORING_OK" = "true" ]; then
            echo "âœ… Monitoring stack is operational!"
          else
            echo "âš ï¸  Some monitoring components are not responding"
          fi

  # ğŸ—„ï¸ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
  database-integrity-checks:
    name: ğŸ—„ï¸ Database Integrity Checks
    runs-on: self-hosted
    needs: basic-health-checks
    timeout-minutes: 5
    steps:
      - name: ğŸ—„ï¸ Verify database
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ—„ï¸ DATABASE INTEGRITY CHECKS"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          
          # 1. Database size
          echo "1ï¸âƒ£ Checking database size..."
          DB_SIZE=$(docker exec postgres psql -U n8n -d n8n -t -c \
            "SELECT pg_size_pretty(pg_database_size('n8n'));" | xargs)
          echo "   ğŸ“¦ Database size: $DB_SIZE"
          
          # 2. Tables count
          echo "2ï¸âƒ£ Checking tables..."
          TABLE_COUNT=$(docker exec postgres psql -U n8n -d n8n -t -c \
            "SELECT COUNT(*) FROM information_schema.tables WHERE table_schema='public';" | xargs)
          echo "   ğŸ“Š Tables count: $TABLE_COUNT"
          
          # 3. Workflows count
          echo "3ï¸âƒ£ Checking workflows in DB..."
          WORKFLOW_COUNT=$(docker exec postgres psql -U n8n -d n8n -t -c \
            "SELECT COUNT(*) FROM workflow_entity;" | xargs)
          echo "   ğŸ”„ Workflows in database: $WORKFLOW_COUNT"
          
          # 4. Executions count
          echo "4ï¸âƒ£ Checking executions..."
          EXEC_COUNT=$(docker exec postgres psql -U n8n -d n8n -t -c \
            "SELECT COUNT(*) FROM execution_entity;" | xargs)
          echo "   â–¶ï¸  Total executions: $EXEC_COUNT"
          
          # 5. Database connections
          echo "5ï¸âƒ£ Checking active connections..."
          CONN_COUNT=$(docker exec postgres psql -U n8n -d n8n -t -c \
            "SELECT COUNT(*) FROM pg_stat_activity WHERE datname='n8n';" | xargs)
          echo "   ğŸ”Œ Active connections: $CONN_COUNT"
          
          echo ""
          echo "âœ… Database integrity verified!"

  # ğŸš€ Performance Ñ‚ĞµÑÑ‚Ñ‹
  performance-benchmarks:
    name: ğŸš€ Performance Benchmarks
    runs-on: self-hosted
    needs: [basic-health-checks, workflow-functionality-tests]
    timeout-minutes: 5
    steps:
      - name: ğŸš€ Run performance tests
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸš€ PERFORMANCE BENCHMARKS"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          
          # 1. n8n response time
          echo "1ï¸âƒ£ Testing n8n response time..."
          START=$(date +%s%3N)
          curl -sf ${{ env.N8N_URL }}/healthz > /dev/null
          END=$(date +%s%3N)
          RESPONSE_TIME=$((END - START))
          echo "   âš¡ Response time: ${RESPONSE_TIME}ms"
          
          if [ $RESPONSE_TIME -lt 500 ]; then
            echo "   âœ… Excellent response time!"
          elif [ $RESPONSE_TIME -lt 1000 ]; then
            echo "   âœ… Good response time"
          else
            echo "   âš ï¸  Slow response time"
          fi
          
          # 2. Docker stats
          echo "2ï¸âƒ£ Checking resource usage..."
          docker stats --no-stream --format \
            "table {{.Name}}\t{{.CPUPerc}}\t{{.MemUsage}}" \
            n8n-app postgres redis 2>/dev/null || true
          
          # 3. System resources
          echo "3ï¸âƒ£ System resources..."
          echo "   ğŸ’¾ Memory:"
          free -h | grep Mem
          echo "   ğŸ’¿ Disk:"
          df -h / | tail -1
          echo "   âš™ï¸  CPU load:"
          uptime
          
          echo ""
          echo "âœ… Performance benchmarks completed!"

  # ğŸ” Security checks
  security-verification:
    name: ğŸ” Security Verification
    runs-on: self-hosted
    needs: basic-health-checks
    timeout-minutes: 5
    steps:
      - name: ğŸ” Security checks
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ” SECURITY VERIFICATION"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          
          SECURITY_OK=true
          
          # 1. Check .env permissions
          echo "1ï¸âƒ£ Checking .env file security..."
          if [ -f "${{ env.DEPLOY_DIR }}/.env" ]; then
            PERMS=$(stat -c %a "${{ env.DEPLOY_DIR }}/.env")
            if [ "$PERMS" = "600" ]; then
              echo "   âœ… .env has correct permissions (600)"
            else
              echo "   âš ï¸  .env permissions: $PERMS (should be 600)"
              SECURITY_OK=false
            fi
          fi
          
          # 2. Check exposed ports
          echo "2ï¸âƒ£ Checking exposed ports..."
          EXPOSED_PORTS=$(docker ps --format '{{.Names}}: {{.Ports}}' | grep -E 'n8n|postgres|redis')
          echo "$EXPOSED_PORTS"
          
          # 3. Check Docker networks
          echo "3ï¸âƒ£ Checking Docker networks..."
          NETWORKS=$(docker network ls --format '{{.Name}}' | grep n8n || true)
          if [ -n "$NETWORKS" ]; then
            echo "   ğŸ“¡ n8n networks: $NETWORKS"
          fi
          
          # 4. Check firewall status
          echo "4ï¸âƒ£ Checking firewall..."
          if command -v ufw >/dev/null 2>&1; then
            UFW_STATUS=$(sudo ufw status | head -1)
            echo "   ğŸ›¡ï¸  $UFW_STATUS"
          else
            echo "   âš ï¸  UFW not installed"
          fi
          
          echo ""
          if [ "$SECURITY_OK" = "true" ]; then
            echo "âœ… Security checks passed!"
          else
            echo "âš ï¸  Some security concerns detected"
          fi

  # ğŸŒ End-to-End Integration Test
  e2e-integration-test:
    name: ğŸŒ E2E Integration Test
    runs-on: self-hosted
    needs: [workflow-functionality-tests, database-integrity-checks]
    timeout-minutes: 10
    steps:
      - name: ğŸŒ Full pipeline test
        env:
          N8N_API_KEY: ${{ secrets.N8N_API_KEY }}
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸŒ END-TO-END INTEGRATION TEST"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          
          # 1. Create test workflow via API
          echo "1ï¸âƒ£ Creating test workflow..."
          TEST_WORKFLOW='{"name":"CI-Test-Workflow-'$(date +%s)'","nodes":[{"parameters":{},"name":"Start","type":"n8n-nodes-base.start","typeVersion":1,"position":[250,300]}],"connections":{},"active":false}'
          
          CREATE_RESPONSE=$(curl -sf -X POST \
            -H "X-N8N-API-KEY: $N8N_API_KEY" \
            -H "Content-Type: application/json" \
            -d "$TEST_WORKFLOW" \
            "${{ env.N8N_URL }}/api/v1/workflows")
          
          if [ -n "$CREATE_RESPONSE" ]; then
            WORKFLOW_ID=$(echo "$CREATE_RESPONSE" | jq -r '.id')
            echo "   âœ… Test workflow created: ID=$WORKFLOW_ID"
            
            # 2. Retrieve workflow
            echo "2ï¸âƒ£ Retrieving workflow..."
            GET_RESPONSE=$(curl -sf \
              -H "X-N8N-API-KEY: $N8N_API_KEY" \
              "${{ env.N8N_URL }}/api/v1/workflows/$WORKFLOW_ID")
            
            if [ -n "$GET_RESPONSE" ]; then
              echo "   âœ… Workflow retrieved successfully"
            else
              echo "   âŒ Failed to retrieve workflow"
              exit 1
            fi
            
            # 3. Delete test workflow
            echo "3ï¸âƒ£ Cleaning up test workflow..."
            curl -sf -X DELETE \
              -H "X-N8N-API-KEY: $N8N_API_KEY" \
              "${{ env.N8N_URL }}/api/v1/workflows/$WORKFLOW_ID" > /dev/null
            
            echo "   âœ… Test workflow deleted"
          else
            echo "   âŒ Failed to create test workflow"
            exit 1
          fi
          
          # 4. Test database write/read cycle
          echo "4ï¸âƒ£ Testing database operations..."
          DB_TEST_VALUE="test_$(date +%s)"
          docker exec postgres psql -U n8n -d n8n -c \
            "CREATE TABLE IF NOT EXISTS ci_test (value TEXT);" > /dev/null
          docker exec postgres psql -U n8n -d n8n -c \
            "INSERT INTO ci_test VALUES ('$DB_TEST_VALUE');" > /dev/null
          
          RETRIEVED=$(docker exec postgres psql -U n8n -d n8n -t -c \
            "SELECT value FROM ci_test WHERE value='$DB_TEST_VALUE';" | xargs)
          
          if [ "$RETRIEVED" = "$DB_TEST_VALUE" ]; then
            echo "   âœ… Database write/read successful"
            docker exec postgres psql -U n8n -d n8n -c "DROP TABLE ci_test;" > /dev/null
          else
            echo "   âŒ Database operation failed"
            exit 1
          fi
          
          # 5. Test Redis operations
          echo "5ï¸âƒ£ Testing Redis cache..."
          REDIS_TEST="redis_test_$(date +%s)"
          docker exec redis redis-cli SET ci_test "$REDIS_TEST" > /dev/null
          REDIS_VALUE=$(docker exec redis redis-cli GET ci_test)
          
          if [ "$REDIS_VALUE" = "$REDIS_TEST" ]; then
            echo "   âœ… Redis operations successful"
            docker exec redis redis-cli DEL ci_test > /dev/null
          else
            echo "   âŒ Redis operation failed"
            exit 1
          fi
          
          echo ""
          echo "âœ… End-to-end integration test PASSED!"

  # ğŸ“‹ Final Summary
  final-verification-summary:
    name: ğŸ“‹ Final Verification Summary
    runs-on: self-hosted
    needs: 
      - basic-health-checks
      - workflow-functionality-tests
      - monitoring-stack-verification
      - database-integrity-checks
      - performance-benchmarks
      - security-verification
      - e2e-integration-test
    if: always()
    steps:
      - name: ğŸ“‹ Generate summary
        run: |
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "               ğŸ‰ FINAL VERIFICATION SUMMARY ğŸ‰                "
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ¥ Basic Health:          ${{ needs.basic-health-checks.result }}"
          echo "ğŸ§ª Workflow Tests:        ${{ needs.workflow-functionality-tests.result }}"
          echo "ğŸ“Š Monitoring Stack:      ${{ needs.monitoring-stack-verification.result }}"
          echo "ğŸ—„ï¸  Database Integrity:   ${{ needs.database-integrity-checks.result }}"
          echo "ğŸš€ Performance:           ${{ needs.performance-benchmarks.result }}"
          echo "ğŸ” Security:              ${{ needs.security-verification.result }}"
          echo "ğŸŒ E2E Integration:       ${{ needs.e2e-integration-test.result }}"
          echo ""
          echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
          echo "Service Status:"
          echo "  â€¢ n8n:        ${{ needs.basic-health-checks.outputs.n8n_status }}"
          echo "  â€¢ PostgreSQL: ${{ needs.basic-health-checks.outputs.db_status }}"
          echo "  â€¢ Redis:      ${{ needs.basic-health-checks.outputs.redis_status }}"
          echo "  â€¢ Tor:        ${{ needs.basic-health-checks.outputs.tor_status }}"
          echo ""
          echo "Workflow Status:"
          echo "  â€¢ Active workflows: ${{ needs.workflow-functionality-tests.outputs.workflows_active }}"
          echo "  â€¢ Webhooks working: ${{ needs.workflow-functionality-tests.outputs.webhooks_working }}"
          echo ""
          echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
          echo "Access URLs:"
          echo "  â€¢ n8n:        ${{ env.N8N_URL }}"
          echo "  â€¢ Grafana:    ${{ env.GRAFANA_URL }}"
          echo "  â€¢ Prometheus: ${{ env.PROMETHEUS_URL }}"
          echo ""
          echo "Deployment Info:"
          echo "  â€¢ Commit:  ${{ github.sha }}"
          echo "  â€¢ Branch:  ${{ github.ref }}"
          echo "  â€¢ Actor:   ${{ github.actor }}"
          echo "  â€¢ Time:    $(date)"
          echo ""
          
          # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ²ÑĞµÑ… Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ²
          ALL_PASSED=true
          
          if [ "${{ needs.basic-health-checks.result }}" != "success" ]; then
            ALL_PASSED=false
          fi
          if [ "${{ needs.workflow-functionality-tests.result }}" != "success" ]; then
            ALL_PASSED=false
          fi
          if [ "${{ needs.e2e-integration-test.result }}" != "success" ]; then
            ALL_PASSED=false
          fi
          
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          if [ "$ALL_PASSED" = "true" ]; then
            echo "                  âœ… EVERYTHING IS Ğ—Ğ•Ğ‘Ğ! âœ…                    "
            echo "           Production system is FULLY OPERATIONAL!            "
          else
            echo "                 âš ï¸  SOME CHECKS FAILED âš ï¸                    "
            echo "          Review logs above for detailed information          "
          fi
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          
          # Exit code
          if [ "$ALL_PASSED" != "true" ]; then
            exit 1
          fi
