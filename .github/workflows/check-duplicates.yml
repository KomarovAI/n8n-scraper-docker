name: Check Documentation Duplicates

on:
  pull_request:
    paths:
      - '.ai/**'
      - '.cursorrules'
      - '.windsurfrules'
      - '.github/copilot-instructions.md'
      - 'docs/**'
      - 'README.md'
  push:
    branches:
      - main
    paths:
      - '.ai/**'
      - 'docs/**'

jobs:
  check-duplicates:
    name: Check for duplicate AI instructions
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Check for duplicate AI instruction files
        run: |
          echo "üîç Checking for duplicate AI instruction files..."
          
          DUPLICATES_FOUND=false
          
          if [ -f .cursorrules ]; then
            echo "‚ùå Found .cursorrules (should use .ai/instructions.md instead)"
            DUPLICATES_FOUND=true
          fi
          
          if [ -f .windsurfrules ]; then
            echo "‚ùå Found .windsurfrules (should use .ai/instructions.md instead)"
            DUPLICATES_FOUND=true
          fi
          
          if [ -f .github/copilot-instructions.md ]; then
            echo "‚ùå Found .github/copilot-instructions.md (should use .ai/instructions.md instead)"
            DUPLICATES_FOUND=true
          fi
          
          if [ "$DUPLICATES_FOUND" = true ]; then
            echo ""
            echo "‚ö†Ô∏è  Duplicate AI instruction files detected!"
            echo "üìñ All AI assistants should use: .ai/instructions.md"
            echo "üìã See .aidocs-map.json for documentation structure"
            exit 1
          fi
          
          echo "‚úÖ No duplicate AI instruction files found"

      - name: Verify .aidocs-map.json exists
        run: |
          if [ ! -f .aidocs-map.json ]; then
            echo "‚ùå Missing .aidocs-map.json - documentation structure map required"
            exit 1
          fi
          echo "‚úÖ .aidocs-map.json exists"

      - name: Validate primary AI instructions exist
        run: |
          if [ ! -f .ai/instructions.md ]; then
            echo "‚ùå Missing .ai/instructions.md - primary AI instructions required"
            exit 1
          fi
          echo "‚úÖ .ai/instructions.md exists ($(wc -l < .ai/instructions.md) lines)"

      - name: Check for TODO comments in AI instructions
        run: |
          if grep -i "TODO\|FIXME\|XXX" .ai/instructions.md; then
            echo "‚ö†Ô∏è  Warning: Found TODO/FIXME comments in AI instructions"
            echo "This is not a failure, but consider completing these tasks"
          else
            echo "‚úÖ No TODO comments in AI instructions"
          fi

      - name: Summary
        if: success()
        run: |
          echo ""
          echo "‚úÖ Documentation Structure Validation Passed"
          echo ""
          echo "üìä Statistics:"
          echo "   ‚Ä¢ Primary AI instructions: .ai/instructions.md ($(wc -l < .ai/instructions.md) lines)"
          echo "   ‚Ä¢ Documentation map: .aidocs-map.json"
          echo "   ‚Ä¢ No duplicate AI instruction files"
          echo ""
          echo "üöÄ All checks passed successfully!"
