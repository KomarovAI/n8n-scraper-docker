{
  "name": "Smart Web Scraper - Production",
  "active": false,
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "scrape",
        "authentication": "none",
        "responseMode": "lastNode",
        "options": {}
      },
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "position": [
        250,
        300
      ],
      "webhookId": "scraper-webhook"
    },
    {
      "parameters": {
        "functionCode": "// SSRF Protection & Input Validation\nconst url = $input.item.json.url;\nconst selector = $input.item.json.selector || 'body';\n\n// Validate URL\nif (!url || !url.startsWith('http')) {\n  throw new Error('Invalid URL');\n}\n\n// SSRF Protection\nconst blockedHosts = ['localhost', '127.0.0.1', '0.0.0.0', '169.254.169.254', 'metadata.google.internal'];\nconst urlObj = new URL(url);\nif (blockedHosts.includes(urlObj.hostname)) {\n  throw new Error('SSRF detected - blocked host');\n}\n\nreturn {\n  json: {\n    url,\n    selector,\n    requestId: `scrape-${Date.now()}`,\n    timestamp: new Date().toISOString()\n  }\n};"
      },
      "name": "Input Validator",
      "type": "n8n-nodes-base.code",
      "position": [
        450,
        300
      ]
    },
    {
      "parameters": {
        "url": "={{$json.url}}",
        "options": {
          "timeout": 30000
        },
        "headerParameters": {
          "parameters": [
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/120.0.0.0"
            },
            {
              "name": "Accept",
              "value": "text/html,application/xhtml+xml"
            }
          ]
        }
      },
      "name": "HTTP Request",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        650,
        300
      ]
    },
    {
      "parameters": {
        "functionCode": "// Extract content from HTML\nconst html = $input.item.body;\nconst url = $input.item.json.url;\nconst requestId = $input.item.json.requestId;\n\ntry {\n  // Extract title\n  const titleMatch = /<title>(.*?)<\\/title>/i.exec(html);\n  const title = titleMatch ? titleMatch[1] : '';\n  \n  // Extract main content\n  const mainRegex = /<main.*?>([\\s\\S]+?)<\\/main>/i;\n  const articleRegex = /<article.*?>([\\s\\S]+?)<\\/article>/i;\n  const bodyRegex = /<body.*?>([\\s\\S]+?)<\\/body>/i;\n  \n  let mainContent = mainRegex.exec(html)?.[1] || \n                    articleRegex.exec(html)?.[1] || \n                    bodyRegex.exec(html)?.[1] || \n                    html;\n  \n  // Clean content\n  mainContent = mainContent\n    .replace(/<script[^>]*>.*?<\\/script>/gis, '')\n    .replace(/<style[^>]*>.*?<\\/style>/gis, '')\n    .replace(/<[^>]+>/g, ' ')\n    .replace(/\\s+/g, ' ')\n    .trim()\n    .substring(0, 50000);\n  \n  return {\n    json: {\n      success: true,\n      url,\n      requestId,\n      timestamp: new Date().toISOString(),\n      data: {\n        title,\n        content: mainContent,\n        content_length: mainContent.length,\n        html_length: html.length\n      }\n    }\n  };\n} catch (error) {\n  return {\n    json: {\n      success: false,\n      url,\n      requestId,\n      error: error.message,\n      timestamp: new Date().toISOString()\n    }\n  };\n}"
      },
      "name": "Extract Content",
      "type": "n8n-nodes-base.code",
      "position": [
        850,
        300
      ]
    }
  ],
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Input Validator",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Input Validator": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Extract Content",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  }
}