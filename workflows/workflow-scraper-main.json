{
  "name": "Smart Web Scraper - Production",
  "active": false,
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "scrape",
        "authentication": "none",
        "responseMode": "lastNode",
        "options": {}
      },
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "position": [250, 300],
      "webhookId": "scraper-webhook"
    },
    {
      "parameters": {
        "functionCode": "// SSRF Protection & Input Validation\nconst url = $input.item.json.url;\nconst selector = $input.item.json.selector || 'body';\nconst waitFor = $input.item.json.waitFor;\n\n// Validate URL\nif (!url || !url.startsWith('http')) {\n  throw new Error('Invalid URL');\n}\n\n// SSRF Protection\nconst blockedHosts = ['localhost', '127.0.0.1', '0.0.0.0', '169.254.169.254', 'metadata.google.internal'];\nconst urlObj = new URL(url);\nif (blockedHosts.includes(urlObj.hostname)) {\n  throw new Error('SSRF detected - blocked host');\n}\n\n// Detect site type\nconst needsJS = ['javascript', 'react', 'vue', 'angular', 'spa'].some(keyword => url.toLowerCase().includes(keyword));\nconst isProtected = ['cloudflare', 'datadome', 'akamai'].some(keyword => url.toLowerCase().includes(keyword));\n\nreturn {\n  json: {\n    url,\n    selector,\n    waitFor,\n    needsJS,\n    isProtected,\n    requestId: `scrape-${Date.now()}`,\n    timestamp: new Date().toISOString()\n  }\n};"
      },
      "name": "Input Validator",
      "type": "n8n-nodes-base.code",
      "position": [450, 300]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{$json.isProtected}}",
              "value2": true
            }
          ]
        }
      },
      "name": "Protected Site?",
      "type": "n8n-nodes-base.if",
      "position": [650, 300]
    },
    {
      "parameters": {
        "functionCode": "// Simple mock response for testing\nreturn {\n  json: {\n    success: true,\n    url: $json.url,\n    requestId: $json.requestId,\n    timestamp: $json.timestamp,\n    needsJS: $json.needsJS,\n    isProtected: $json.isProtected,\n    message: 'Workflow executed successfully (mock response for CI testing)',\n    data: {\n      title: 'Test Page',\n      content: 'Mock content for testing purposes'\n    }\n  }\n};"
      },
      "name": "Mock Response",
      "type": "n8n-nodes-base.code",
      "position": [850, 300]
    }
  ],
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Input Validator",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Input Validator": {
      "main": [
        [
          {
            "node": "Protected Site?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Protected Site?": {
      "main": [
        [
          {
            "node": "Mock Response",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mock Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  }
}