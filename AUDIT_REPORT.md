# N8N Scraper - Audit Report

–î–∞—Ç–∞: 18 –Ω–æ—è–±—Ä—è 2025  
–í–µ—Ä—Å–∏—è: 1.0  
–°—Ç–∞—Ç—É—Å: ‚úÖ –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

## üîç –û–±–∑–æ—Ä –∞—É–¥–∏—Ç–∞

–ü—Ä–æ–≤–µ–¥–µ–Ω –ø–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç Kubernetes-–º–∞–Ω–∏—Ñ–µ—Å—Ç–æ–≤, —Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–µ–ø–ª–æ—è –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π. –ù–∞–π–¥–µ–Ω–æ **11 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö/–≤–∞–∂–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º** –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ **15+ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π**.

---

## ‚ùå –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (–ò–°–ü–†–ê–í–õ–ï–ù–û)

### 1. –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã –¥–ª—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

**–ü—Ä–æ–±–ª–µ–º–∞:**  
StatefulSet N8N —Å—Å—ã–ª–∞–ª—Å—è –Ω–∞:
- `postgresql.n8n-scraper.svc.cluster.local`
- `redis.n8n-scraper.svc.cluster.local`

–ù–æ –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã –¥–ª—è PostgreSQL –∏ Redis –û–¢–°–£–¢–°–¢–í–û–í–ê–õ–ò!

**–†–µ—à–µ–Ω–∏–µ:**
‚úÖ –°–æ–∑–¥–∞–Ω—ã:
- `manifests/postgresql.yaml` - StatefulSet + Headless Service
- `manifests/redis.yaml` - StatefulSet + Headless Service

---

### 2. IngressRoute: –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–µ –ø–æ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:**
```yaml
match: Host(`n8n.${SERVER_IP}.nip.io`)
```
Kubernetes –ù–ï –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —à–∞–±–ª–æ–Ω–∏–∑–∞—Ü–∏—é `${VAR}` –≤ –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞—Ö!

**–†–µ—à–µ–Ω–∏–µ:**
‚úÖ –ó–∞–º–µ–Ω–µ–Ω–æ –Ω–∞ `YOUR_SERVER_IP` —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π  
‚úÖ deploy.sh –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–º–µ–Ω—è–µ—Ç –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π IP

---

### 3. deploy.sh: –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ `kubectl`
- –ù–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–ª–∞—Å—Ç–µ—Ä—É
- –ù–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ `secret.yaml`
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –¥–µ–ø–ª–æ—è (N8N –ø–µ—Ä–µ–¥ PostgreSQL!)

**–†–µ—à–µ–Ω–∏–µ:**
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏  
‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫: Namespace ‚Üí Secrets ‚Üí PostgreSQL ‚Üí Redis ‚Üí N8N ‚Üí Services ‚Üí IngressRoute  
‚úÖ –û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ PostgreSQL/Redis –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º N8N

---

### 4. NetworkPolicy: –î–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º namespace

**–ü—Ä–æ–±–ª–µ–º–∞:**
```yaml
egress:
  - to:
      - namespaceSelector: {}  # –í–°–ï namespace!!!
```
–≠—Ç–æ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –ø–æ–¥–∞–º –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ!

**–†–µ—à–µ–Ω–∏–µ:**
‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω `ipBlock` —Å CIDR  
‚úÖ –ò—Å–∫–ª—é—á–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏ (10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16)  
‚úÖ –ò—Å–∫–ª—é—á–µ–Ω—ã cloud metadata endpoints (169.254.169.254)  
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –æ—Ç–¥–µ–ª—å–Ω—ã–µ NetworkPolicy –¥–ª—è PostgreSQL –∏ Redis

---

### 5. N8N StatefulSet: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç Init Container

**–ü—Ä–æ–±–ª–µ–º–∞:**  
N8N –º–æ–∂–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è —Ä–∞–Ω—å—à–µ PostgreSQL ‚Üí crash loop!

**–†–µ—à–µ–Ω–∏–µ:**
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `initContainer` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ PostgreSQL

---

### 6. Resource Limits: –°–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞:**
```yaml
limits:
  memory: 2Gi    # –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ!
  cpu: 2000m     # 2 —Ü–µ–ª—ã—Ö CPU!
```

**–†–µ—à–µ–Ω–∏–µ:**
‚úÖ –£–º–µ–Ω—å—à–µ–Ω–æ –¥–æ `memory: 1Gi, cpu: 1000m`  
‚úÖ Requests —É–º–µ–Ω—å—à–µ–Ω—ã –¥–æ `memory: 512Mi, cpu: 250m`

---

### 7. Liveness/Readiness Probes: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π endpoint

**–ü—Ä–æ–±–ª–µ–º–∞:**  
`/healthz` –º–æ–∂–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å Basic Auth ‚Üí probes –±—É–¥—É—Ç –ø–∞–¥–∞—Ç—å!

**–†–µ—à–µ–Ω–∏–µ:**
‚úÖ –ò–∑–º–µ–Ω–µ–Ω–æ –Ω–∞ `/` (root) —Å User-Agent header  
‚úÖ –£–≤–µ–ª–∏—á–µ–Ω—ã timeouts –∏ initialDelaySeconds

---

### 8. N8N Environment: –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤–∞–∂–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

**–ü—Ä–æ–±–ª–µ–º–∞:**  
–û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏:
- `EXECUTIONS_DATA_SAVE_ON_ERROR`
- `EXECUTIONS_DATA_SAVE_ON_SUCCESS`
- `N8N_DIAGNOSTICS_ENABLED`
- `GENERIC_TIMEZONE`

**–†–µ—à–µ–Ω–∏–µ:**
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ env vars –∏–∑ docker-compose.yml

---

### 9. uninstall.sh: –ù–µ —É–¥–∞–ª—è–µ—Ç PostgreSQL/Redis

**–ü—Ä–æ–±–ª–µ–º–∞:**  
–°–∫—Ä–∏–ø—Ç —É–¥–∞–ª—è–ª —Ç–æ–ª—å–∫–æ N8N, –Ω–æ –Ω–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö!

**–†–µ—à–µ–Ω–∏–µ:**
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ —É–¥–∞–ª–µ–Ω–∏–µ PostgreSQL, Redis, –≤—Å–µ—Ö PVC  
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –æ–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–æ–¥–æ–≤

---

## ‚úÖ –ü—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –ú–∞–Ω–∏—Ñ–µ—Å—Ç—ã
1. ‚úÖ **PostgreSQL StatefulSet** —Å headless service, probes, resource limits
2. ‚úÖ **Redis StatefulSet** —Å persistence, AOF, probes
3. ‚úÖ **Init Container** –¥–ª—è N8N (–ø—Ä–æ–≤–µ—Ä–∫–∞ PostgreSQL)
4. ‚úÖ **–£–ª—É—á—à–µ–Ω–Ω—ã–µ probes** —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ endpoints
5. ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã resource limits** (—É–º–µ–Ω—å—à–µ–Ω—ã –Ω–∞ 50%)
6. ‚úÖ **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ env vars** –¥–ª—è N8N
7. ‚úÖ **NetworkPolicy –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞** (N8N, PostgreSQL, Redis)
8. ‚úÖ **CIDR-based egress rules** –≤–º–µ—Å—Ç–æ namespaceSelector: {}
9. ‚úÖ **Timezone –Ω–∞—Å—Ç—Ä–æ–π–∫–∞** (Europe/Moscow)

### –°–∫—Ä–∏–ø—Ç—ã
10. ‚úÖ **deploy.sh –ø—Ä–æ–≤–µ—Ä–∫–∏**: kubectl, cluster access, secrets
11. ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–º–µ–Ω–∞** SERVER_IP –≤ IngressRoute
12. ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫** –¥–µ–ø–ª–æ—è
13. ‚úÖ **–û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏** –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
14. ‚úÖ **uninstall.sh –ø–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ** –≤—Å–µ—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
15. ‚úÖ **–£–ª—É—á—à–µ–Ω–Ω—ã–π UX** —Å emoji –∏ —á—ë—Ç–∫–∏–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

---

## üìä –ò—Ç–æ–≥–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ |
|---------|-----|--------|
| –ú–∞–Ω–∏—Ñ–µ—Å—Ç—ã | 6 —Ñ–∞–π–ª–æ–≤ | 9 —Ñ–∞–π–ª–æ–≤ |
| StatefulSets | 1 (N8N) | 3 (N8N, PostgreSQL, Redis) |
| NetworkPolicies | 1 (—Å–ª–∞–±–∞—è) | 3 (—Å—Ç—Ä–æ–≥–∏–µ) |
| Resource Limits (N8N) | 2Gi/2CPU | 1Gi/1CPU (-50%) |
| Init Containers | 0 | 1 |
| Env Variables (N8N) | 10 | 16 (+60%) |
| deploy.sh –ø—Ä–æ–≤–µ—Ä–∫–∏ | 0 | 5 |
| –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ | 9 | 0 ‚úÖ |

---

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –±—É–¥—É—â–µ–µ

### –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ):

1. **HorizontalPodAutoscaler** –¥–ª—è N8N
   ```yaml
   minReplicas: 1
   maxReplicas: 5
   targetCPUUtilizationPercentage: 70
   ```

2. **PodDisruptionBudget** –¥–ª—è HA
   ```yaml
   minAvailable: 1
   ```

3. **ServiceMonitor** –¥–ª—è Prometheus Operator
   ```yaml
   endpoints:
     - port: web
       path: /metrics
   ```

4. **ResourceQuota** –¥–ª—è namespace
   ```yaml
   hard:
     requests.cpu: "4"
     requests.memory: 8Gi
   ```

5. **Kustomize overlays** –¥–ª—è dev/staging/prod

6. **Backup CronJob** –¥–ª—è PostgreSQL (–∫–∞–∫ –≤ 3xui)

7. **External Secrets Operator** –≤–º–µ—Å—Ç–æ —Ä—É—á–Ω—ã—Ö secrets

---

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í—Å–µ **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã**.  
–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Ç–µ–ø–µ—Ä—å **production-ready** –∏ —Å–ª–µ–¥—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º 3xui-k8s-statefulset:

‚úÖ –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞  
‚úÖ StatefulSet –¥–ª—è –≤—Å–µ—Ö stateful –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤  
‚úÖ Headless Services  
‚úÖ –°—Ç—Ä–æ–≥–∏–µ NetworkPolicy  
‚úÖ Resource limits –∏ probes  
‚úÖ Init containers –¥–ª—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π  
‚úÖ –ü—Ä–æ—Å—Ç–æ–π –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ ./deploy.sh  

---

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞—É–¥–∏—Ç–∞:** 18.11.2025  
**–í—ã–ø–æ–ª–Ω–∏–ª:** KomarovAI  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ READY FOR PRODUCTION
